<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PM Internship Scheme</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="description" content="Official Government of India PM Internship Portal for youth development and career opportunities">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="PM Internship">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    
    <!-- PWA Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="{{ url_for('static', filename='images/icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='images/icons/icon-192x192.png') }}">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0&icon_names=work" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/home.css') }}">

</head>
<body>
    <!-- Header Section -->
    <header class="header">
        <button class="profile-toggle" id="profileToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="logo-container">
            <img src="static/images/mca_logo_1.svg" alt="Official Logo" class="logo">
            <img src="static/images/pm_internship_logo_eng.svg" alt="Official Logo" class="logo1">
        </div>
        
        <nav class="nav-items">
            <a href="#" class="nav-item">
                <i class="fas fa-question-circle"></i>
                <span>{{ t('nav.faqs') }}</span>
            </a>
            <a href="#" class="nav-item">
                <i class="fas fa-book"></i>
                <span>{{ t('nav.guidelines') }}</span>
            </a>
            <div class="language-selector">
                <button type="button" class="language-btn" onclick="toggleLanguageDropdown()">
                    <i class="fas fa-globe"></i>
                    <span>
                        {% if session.get('language') == 'hi' %}
                            हिंदी
                        {% elif session.get('language') == 'mr' %}
                            मराठी
                        {% else %}
                            English
                        {% endif %}
                    </span>
                </button>
                <div class="language-options" id="languageDropdown">
                    <a href="/language/en" class="language-option">English</a>
                    <a href="/language/hi" class="language-option">हिंदी</a>
                    <a href="/language/mr" class="language-option">मराठी</a>
                </div>
            </div>
            <a href="{{ url_for('profile') }}" class="nav-item">
                <i class="fas fa-user"></i>
                <span>{{ t('nav.profile') }}</span>
            </a>
            <a href="{{ url_for('logout') }}" class="nav-item">
                <i class="fas fa-sign-out-alt"></i>
                <span>{{ t('nav.logout') }}</span>
            </a>
        </nav>
        
        <div class="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
    </header>

    <!-- Profile and Main Content Section -->
    <div class="profile-container">
        <!-- Sidebar -->
        <aside class="user-profile">
            <div class="profile-header">
                <div class="profile-pic">{{ user_initials or 'U' }}</div>
                <div class="profile-info">
                    <h3>{{ user_name or 'User Name' }}</h3>
                    <p>{{ user_email or 'user@email.com' }}</p>
                </div>
            </div>
            
            <ul class="profile-menu">
                <li><a href="{{ url_for('profile') }}"><i class="fas fa-user-circle"></i> {{ t('sidebar.myProfile') }}</a></li>
                <li><a href="#"><i class="fas fa-file-alt"></i> {{ t('sidebar.myApplications') }}</a></li>
                <li><a href="{{url_for('recommendations') }}"><i class="fas fa-briefcase"></i> {{ t('sidebar.internshipOpportunities') }}</a></li>
                <li><a href="{{ url_for('ats') }}"><i class="fas fa-search"></i> {{ t('sidebar.atsMatching') }}</a></li>
                <li><a href="#"><i class="fas fa-calendar-alt"></i> {{ t('sidebar.importantDates') }}</a></li>
                <li><a href="#"><i class="fas fa-download"></i> {{ t('sidebar.downloads') }}</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> {{ t('sidebar.settings') }}</a></li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Hero Banner with Dynamic Welcome Message -->
            <section class="hero-banner">
                <h1>{{ t('hero.welcomeTitle') }}, {{ user_name.split()[0] if user_name else 'User' }}!</h1>
                <p>{{ t('hero.subtitle') }}</p>
            </section>

            <!-- Eligible Section -->
            <section class="eligible-section">
                <h2 class="section-title">{{ t('eligibility.title') }}</h2>
                
                <div class="eligibility-cards">
                    <div class="card">
                        <img src="static/images/education.svg" alt="Official Logo" class="logo2">
                        <h6 id="h3"><i class="fas fa-graduation-cap"></i> {{ t('eligibility.education') }}</h6>
                        <p id="p">{{ t('eligibility.educationDesc') }}</p>
                    </div>
                    
                    <div class="card">
                        <img src="static/images/age.svg" alt="Official Logo" class="logo3">
                        <div id="agesz">
                        <h3><i class="fas fa-user-check"></i> {{ t('eligibility.age') }}</h3>
                        </div>
                    </div>
                    
                    <div class="card">
                        <img src="static/images/job.svg" alt="Official Logo" class="logo4">
                        <div id="jobsz">
                        <h3>{{ t('eligibility.jobStatus') }}</h3>
                        </div>
                    </div>

                    <div class="card">
                        <img src="static/images/family.svg" alt="Official Logo" class="logo5">
                        <h6>{{ t('eligibility.family') }}</h6>
                        <ul>
                            <li>
                            {{ t('eligibility.familyIncome') }}
                            </li>
                            <li>{{ t('eligibility.familyGovJob') }}</li>
                        </ul>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-column">
                <h3>{{ t('footer.quickLinks') }}</h3>
                <ul class="footer-links">
                    <li><a href="{{ url_for('home') }}"><i class="fas fa-home"></i> {{ t('footer.home') }}</a></li>
                    <li><a href="#"><i class="fas fa-info-circle"></i> {{ t('footer.aboutUs') }}</a></li>
                    <li><a href="#"><i class="fas fa-bell"></i> {{ t('footer.notifications') }}</a></li>
                    <li><a href="#"><i class="fas fa-newspaper"></i> {{ t('footer.newsUpdates') }}</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>{{ t('footer.helpSupport') }}</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fas fa-question-circle"></i> {{ t('footer.faqs') }}</a></li>
                    <li><a href="#"><i class="fas fa-book"></i> {{ t('footer.guidelines') }}</a></li>
                    <li><a href="#"><i class="fas fa-phone-alt"></i> {{ t('footer.contactUs') }}</a></li>
                    <li><a href="#"><i class="fas fa-exclamation-circle"></i> {{ t('footer.privacyPolicy') }}</a></li>
                </ul>
            </div>
            
            <div class="footer-column">
                <h3>{{ t('footer.connectWithUs') }}</h3>
                <ul class="footer-links">
                    <li><a href="#"><i class="fab fa-facebook"></i> {{ t('footer.facebook') }}</a></li>
                    <li><a href="#"><i class="fab fa-twitter"></i> {{ t('footer.twitter') }}</a></li>
                    <li><a href="#"><i class="fab fa-instagram"></i> {{ t('footer.instagram') }}</a></li>
                    <li><a href="#"><i class="fab fa-youtube"></i> {{ t('footer.youtube') }}</a></li>
                </ul>
            </div>
        </div>
        
        <div class="copyright">
            {{ t('footer.copyright') }}
        </div>
    </footer>

    <!-- Chatbot -->
  <!-- Enhanced Chatbot -->
<div class="chatbot" id="chatbot-btn">
    <i class="fas fa-comment-dots"></i>
    <div class="notification-badge" id="notification-badge">1</div>
</div>

<!-- Chat Window -->
<div id="chat-window" class="chat-window">
    <!-- Header -->
    <div class="chat-header">
        <div class="chat-header-info">
            <div class="bot-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="bot-details">
                <span class="bot-name">{{ t('chatbot.assistantName') }}</span>
                <span class="bot-status">{{ t('chatbot.status') }}</span>
            </div>
        </div>
        <div class="chat-controls">
            <button id="speech-toggle" class="speech-toggle-btn" title="Toggle Text-to-Speech">
                <i class="fas fa-volume-up"></i>
            </button>
            <button id="close-chat" class="close-chat-btn">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>
    
    <!-- Messages Area -->
    <div id="chat-messages" class="chat-messages"></div>
    
    <!-- Quick Replies -->
    <div class="quick-replies" id="quick-replies">
        <button class="quick-reply-btn" data-message="How to apply?">{{ t('chatbot.howToApply') }}</button>
        <button class="quick-reply-btn" data-message="Eligibility criteria">{{ t('chatbot.eligibility') }}</button>
        <button class="quick-reply-btn" data-message="Stipend details">{{ t('chatbot.stipend') }}</button>
        <button class="quick-reply-btn" data-message="Contact support">{{ t('chatbot.support') }}</button>
    </div>
    
    <!-- Input Area -->
    <div class="chat-input-area">
        <input id="chat-input" type="text" placeholder="{{ t('chatbot.placeholder') }}" maxlength="500">
        <button id="voice-input" class="voice-input-btn" title="Click to speak your question">
            <i class="fas fa-microphone"></i>
        </button>
        <button id="chat-send" class="send-btn">
            <i class="fas fa-paper-plane"></i>
        </button>
    </div>
</div>

<!-- PWA Install Prompt -->
<div id="installPrompt" class="install-prompt" style="display: none;">
    <div class="install-content">
        <div class="install-icon">📱</div>
        <h3>Install PM Internship App</h3>
        <p>Get the full app experience! Install our app for offline access and native features.</p>
        <div class="install-buttons">
            <button id="installBtn" class="install-btn primary">Install App</button>
            <button id="dismissBtn" class="install-btn secondary">Not Now</button>
        </div>
    </div>
</div>

    <script src="{{ url_for('static', filename='js/home.js') }}"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then((registration) => {
                        console.log('✅ Service Worker registered successfully:', registration.scope);
                    })
                    .catch((error) => {
                        console.log('❌ Service Worker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        const installPrompt = document.getElementById('installPrompt');
        const installBtn = document.getElementById('installBtn');
        const dismissBtn = document.getElementById('dismissBtn');

        // Listen for the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            // Show our custom install prompt
            showInstallPrompt();
        });

        // Show install prompt
        function showInstallPrompt() {
            // Check if user has already dismissed the prompt recently
            const dismissedTime = localStorage.getItem('installPromptDismissed');
            const oneDayAgo = Date.now() - (24 * 60 * 60 * 1000);
            
            if (!dismissedTime || parseInt(dismissedTime) < oneDayAgo) {
                installPrompt.style.display = 'flex';
            }
        }

        // Install button click
        installBtn.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                // Wait for the user to respond to the prompt
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                // Clear the deferred prompt variable
                deferredPrompt = null;
            }
            // Hide the prompt
            installPrompt.style.display = 'none';
        });

        // Dismiss button click
        dismissBtn.addEventListener('click', () => {
            installPrompt.style.display = 'none';
            // Remember that user dismissed the prompt
            localStorage.setItem('installPromptDismissed', Date.now().toString());
        });

        // Listen for app install
        window.addEventListener('appinstalled', (evt) => {
            console.log('✅ PWA App was installed successfully');
            installPrompt.style.display = 'none';
        });

        // Detect if app is running in standalone mode
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            console.log('🎯 App is running in standalone mode');
            document.body.classList.add('standalone');
        }
    </script>

</body>
</html>